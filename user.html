<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>üì¨ –ß–∞—Ç</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            padding: 20px; 
            margin: 0; 
            background: #f1f3f5; 
        }
        h1 { color: #1a73e8; text-align: center; }
        .container { max-width: 800px; margin: 0 auto; }

        /* –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å */
        #user-mode { text-align: center; }
        textarea {
            width: 90%;
            height: 120px;
            padding: 12px;
            border: 2px solid #4285f4;
            border-radius: 10px;
            font-size: 16px;
        }
        button {
            margin: 10px;
            padding: 12px 24px;
            font-size: 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }
        .blue { background: #4285f4; color: white; }
        .red { background: #ea4335; color: white; }

        /* –ê–¥–º–∏–Ω */
        .msg {
            background: white;
            border: 1px solid #ddd;
            margin: 15px 0;
            padding: 18px;
            border-radius: 10px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .reply-area {
            margin-top: 10px;
        }
        .reply-text {
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        .time {
            font-size: 0.9em;
            color: #666;
        }
        .reply-box {
            background: #e8f5e8;
            border-left: 4px solid #34a853;
            padding: 10px;
            margin: 10px 0;
        }
        #admin-mode { display: none; }
        #login-form { text-align: center; margin: 40px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üì¨ –ß–∞—Ç —Å –ú—É—Ä–∑–∏–∫–æ–º</h1>

        <!-- –†–µ–∂–∏–º: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å -->
        <div id="user-mode">
            <h2>–ù–∞–ø–∏—à–∏ –º–Ω–µ</h2>
            <textarea id="msg" placeholder="–¢–≤–æ—ë —Å–æ–æ–±—â–µ–Ω–∏–µ..."></textarea><br>
            <button class="blue" onclick="send()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
            <p><button class="red" onclick="switchToAdmin()">–Ø ‚Äî –∞–¥–º–∏–Ω</button></p>
        </div>

        <!-- –§–æ—Ä–º–∞ –≤—Ö–æ–¥–∞ –∞–¥–º–∏–Ω–∞ -->
        <div id="login-form" style="display:none;">
            <h2>üîê –í—Ö–æ–¥ –≤ –∞–¥–º–∏–Ω–∫—É</h2>
            <input type="password" id="admin-pass" placeholder="–ü–∞—Ä–æ–ª—å"><br>
            <button class="blue" onclick="login()">–í–æ–π—Ç–∏</button>
            <p><button class="red" onclick="backToUser()">‚Üê –ù–∞–∑–∞–¥</button></p>
        </div>

        <!-- –†–µ–∂–∏–º: –ê–¥–º–∏–Ω -->
        <div id="admin-mode">
            <h2>üì¨ –°–æ–æ–±—â–µ–Ω–∏—è</h2>
            <div id="list"></div>
            <p><button class="red" onclick="backToUser()">‚Üê –ù–∞–∑–∞–¥</button></p>
        </div>
    </div>

    <script>
        const PASSWORD = "trofim123"; // ‚Üê –∏–∑–º–µ–Ω–∏ –Ω–∞ —Å–≤–æ–π
        let messages = [];

        // === –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è ===
        function load() {
            try {
                const data = localStorage.getItem("messages");
                messages = data ? JSON.parse(data) : [];
            } catch (e) {
                messages = [];
                localStorage.setItem("messages", "[]");
            }
        }

        // === –°–æ—Ö—Ä–∞–Ω—è–µ–º ===
        function save() {
            try {
                localStorage.setItem("messages", JSON.stringify(messages));
                return true;
            } catch (e) {
                alert("–û—à–∏–±–∫–∞: –Ω–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å.");
                return false;
            }
        }

        // === –û—Ç–ø—Ä–∞–≤–∫–∞ ===
        function send() {
            const text = document.getElementById("msg").value.trim();
            if (!text) {
                alert("–ù–∞–ø–∏—à–∏—Ç–µ —á—Ç–æ-–Ω–∏–±—É–¥—å!");
                return;
            }

            load();
            messages.push({
                id: Date.now(),
                text: text,
                time: new Date().toLocaleString("ru-RU"),
                replied: false
            });
            save();

            document.getElementById("msg").value = "";
            alert("–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!");
        }

        // === –ê–¥–º–∏–Ω: –≤—Ö–æ–¥ ===
        function switchToAdmin() {
            document.getElementById("user-mode").style.display = "none";
            document.getElementById("login-form").style.display = "block";
        }

        function backToUser() {
            document.getElementById("login-form").style.display = "none";
            document.getElementById("admin-mode").style.display = "none";
            document.getElementById("user-mode").style.display = "block";
        }

        function login() {
            const input = document.getElementById("admin-pass").value;
            if (input === PASSWORD) {
                document.getElementById("login-form").style.display = "none";
                document.getElementById("admin-mode").style.display = "block";
                loadAdmin();
            } else {
                alert("‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å");
            }
        }

        // === –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è –∞–¥–º–∏–Ω–∞ ===
        function loadAdmin() {
            load();
            const container = document.getElementById("list");
            container.innerHTML = "";

            if (messages.length === 0) {
                container.innerHTML = "<p>–ü–æ–∫–∞ –Ω–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π...</p>";
                return;
            }

            // –ù–æ–≤—ã–µ —Å–≤–µ—Ä—Ö—É
            messages.slice().reverse().forEach(msg => {
                const div = document.createElement("div");
                div.className = "msg";
                div.id = "msg-" + msg.id;

                let content = `
                    <div><strong>üí¨</strong> ${msg.text}</div>
                    <div class="time">üïí ${msg.time}</div>
                `;

                if (msg.replied) {
                    content += `
                        <div class="reply-box">
                            <strong>üìå –í—ã:</strong> ${msg.reply}
                        </div>
                    `;
                } else {
                    content += `
                        <div class="reply-area">
                            <textarea class="reply-text" id="reply_${msg.id}" placeholder="–û—Ç–≤–µ—Ç..."></textarea>
                            <button class="blue" onclick="reply(${msg.id})">–û—Ç–≤–µ—Ç–∏—Ç—å</button>
                            <button class="red" onclick="deleteMsg(${msg.id})">–£–¥–∞–ª–∏—Ç—å</button>
                        </div>
                    `;
                }

                div.innerHTML = content;
                container.appendChild(div);
            });
        }

        // === –û—Ç–≤–µ—Ç ===
        function reply(id) {
            const input = document.getElementById(`reply_${id}`);
            const text = input.value.trim();
            if (!text) {
                alert("–í–≤–µ–¥–∏—Ç–µ –æ—Ç–≤–µ—Ç");
                return;
            }

            load();
            const msg = messages.find(m => m.id == id);
            if (msg) {
                msg.replied = true;
                msg.reply = text;
                save();
            }

            loadAdmin(); // –æ–±–Ω–æ–≤–ª—è–µ–º
        }

        // === –£–¥–∞–ª–µ–Ω–∏–µ ===
        function deleteMsg(id) {
            if (!confirm("–£–¥–∞–ª–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ?")) return;

            load();
            messages = messages.filter(m => m.id != id);
            save();

            loadAdmin(); // –æ–±–Ω–æ–≤–ª—è–µ–º
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º –∞–¥–º–∏–Ω–∫—É –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
        setInterval(() => {
            if (document.getElementById("admin-mode").style.display === "block") {
                loadAdmin();
            }
        }, 5000);

        // –ü–µ—Ä–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
        load();

    </script>
</body>
</html>
