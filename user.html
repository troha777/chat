<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>üì¨ –ß–∞—Ç —Å –¢—Ä–æ—Ñ–∏–º–æ–º</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            padding: 20px; 
            margin: 0; 
            background: #f8f9fa; 
            color: #333;
        }
        .container { max-width: 800px; margin: 0 auto; }

        h1 { text-align: center; color: #1a73e8; }
        textarea {
            width: 90%;
            height: 100px;
            padding: 12px;
            border: 2px solid #4285f4;
            border-radius: 8px;
            font-size: 16px;
            margin: 10px 0;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            font-size: 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }
        .btn-blue { background: #4285f4; color: white; }
        .btn-red { background: #ea4335; color: white; }
        .btn-green { background: #34a853; color: white; }

        #user-mode, #admin-mode, #login-form {
            text-align: center;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin: 20px 0;
        }
        #admin-mode, #login-form { display: none; }

        .msg {
            background: #f1f3f5;
            border: 1px solid #ddd;
            margin: 15px 0;
            padding: 15px;
            border-radius: 8px;
            text-align: left;
        }
        .reply-box {
            background: #e8f5e8;
            border-left: 4px solid #34a853;
            padding: 10px;
            margin: 10px 0;
        }
        .reply-input {
            width: 100%;
            padding: 8px;
            margin: 5px 0;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        .time {
            font-size: 0.9em;
            color: #666;
        }

        #reply-section {
            display: none;
            margin: 30px auto;
            padding: 20px;
            background: #e8f5e8;
            border: 2px solid #34a853;
            border-radius: 10px;
            width: 90%;
            color: #1b5e20;
            text-align: left;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üì¨ –ù–∞–ø–∏—à–∏ –º–Ω–µ</h1>

        <!-- –†–µ–∂–∏–º: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å -->
        <div id="user-mode">
            <h2>–†–∞—Å—Å–∫–∞–∂–∏, —á—Ç–æ —É —Ç–µ–±—è?</h2>
            <textarea id="msg" placeholder="–¢–≤–æ—ë —Å–æ–æ–±—â–µ–Ω–∏–µ..."></textarea><br>
            <button class="btn-blue" onclick="send()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
            <p><button class="btn-red" onclick="switchToAdmin()">–Ø ‚Äî –∞–¥–º–∏–Ω</button></p>

            <!-- –û—Ç–≤–µ—Ç –æ—Ç –∞–¥–º–∏–Ω–∞ -->
            <div id="reply-section">
                <h3>üìå –û—Ç–≤–µ—Ç:</h3>
                <p id="reply-text"></p>
            </div>
        </div>

        <!-- –í—Ö–æ–¥ –∞–¥–º–∏–Ω–∞ -->
        <div id="login-form">
            <h2>üîê –í—Ö–æ–¥ –≤ –∞–¥–º–∏–Ω–∫—É</h2>
            <input type="password" id="admin-pass" placeholder="–ü–∞—Ä–æ–ª—å"><br><br>
            <button class="btn-blue" onclick="login()">–í–æ–π—Ç–∏</button><br>
            <button class="btn-red" onclick="backToUser()">‚Üê –ù–∞–∑–∞–¥</button>
        </div>

        <!-- –†–µ–∂–∏–º: –ê–¥–º–∏–Ω -->
        <div id="admin-mode">
            <h2>üì¨ –°–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h2>
            <div id="list"></div>
            <p><button class="btn-red" onclick="backToUser()">‚Üê –ù–∞–∑–∞–¥</button></p>
        </div>
    </div>

    <script>
        const ADMIN_PASSWORD = "trofim424004";
        let messages = [];

        // === –ó–∞–≥—Ä—É–∑–∫–∞ ===
        function load() {
            try {
                const data = localStorage.getItem("messages");
                messages = data ? JSON.parse(data) : [];
            } catch (e) {
                messages = [];
                localStorage.setItem("messages", "[]");
            }
        }

        // === –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ ===
        function save() {
            try {
                localStorage.setItem("messages", JSON.stringify(messages));
                return true;
            } catch (e) {
                console.error("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:", e);
                return false;
            }
        }

        // === –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è ===
        function send() {
            const text = document.getElementById("msg").value.trim();
            if (!text) {
                alert("–ù–∞–ø–∏—à–∏—Ç–µ —á—Ç–æ-–Ω–∏–±—É–¥—å!");
                return;
            }

            load();
            const id = Date.now();
            messages.push({
                id: id,
                text: text,
                time: new Date().toLocaleString("ru-RU"),
                replied: false
            });
            save();

            document.getElementById("msg").value = "";
            document.getElementById("status").textContent = "‚úÖ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!";

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø—Ä–∏—à—ë–ª –ª–∏ –æ—Ç–≤–µ—Ç
            checkForReply(id);
        }

        // === –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–≤–µ—Ç–∞ (–∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥) ===
        function checkForReply(id) {
            const interval = setInterval(() => {
                load();
                const msg = messages.find(m => m.id == id);
                if (msg && msg.replied && msg.reply) {
                    document.getElementById("reply-text").textContent = msg.reply;
                    document.getElementById("reply-section").style.display = "block";
                    clearInterval(interval);
                }
            }, 5000);
        }

        // === –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ: –ø—Ä–æ–≤–µ—Ä–∏–º –ø–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ ===
        window.onload = function () {
            load();
            const lastMsg = messages[messages.length - 1];
            if (lastMsg && lastMsg.id) {
                checkForReply(lastMsg.id);
            }
        };

        // === –†–µ–∂–∏–º –∞–¥–º–∏–Ω–∞ ===
        function switchToAdmin() {
            document.getElementById("user-mode").style.display = "none";
            document.getElementById("login-form").style.display = "block";
        }

        function backToUser() {
            document.getElementById("login-form").style.display = "none";
            document.getElementById("admin-mode").style.display = "none";
            document.getElementById("user-mode").style.display = "block";
        }

        function login() {
            const input = document.getElementById("admin-pass").value;
            if (input === ADMIN_PASSWORD) {
                document.getElementById("login-form").style.display = "none";
                document.getElementById("admin-mode").style.display = "block";
                loadAdmin();
            } else {
                alert("‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å");
            }
        }

        // === –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –∞–¥–º–∏–Ω–∫–µ ===
        function loadAdmin() {
            load();
            const container = document.getElementById("list");
            container.innerHTML = "";

            if (messages.length === 0) {
                container.innerHTML = "<p>–ü–æ–∫–∞ –Ω–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π...</p>";
                return;
            }

            // –ù–æ–≤—ã–µ —Å–≤–µ—Ä—Ö—É
            messages.slice().reverse().forEach(msg => {
                const div = document.createElement("div");
                div.className = "msg";
                div.id = "msg-" + msg.id;

                let content = `
                    <div><strong>üí¨</strong> ${msg.text}</div>
                    <div class="time">üïí ${msg.time}</div>
                `;

                if (msg.replied) {
                    content += `
                        <div class="reply-box">
                            <strong>üìå –í—ã:</strong> ${msg.reply}
                        </div>
                    `;
                } else {
                    content += `
                        <div class="reply-area">
                            <textarea class="reply-input" id="reply_${msg.id}" placeholder="–û—Ç–≤–µ—Ç..."></textarea>
                            <button class="btn-green" onclick="reply(${msg.id})">–û—Ç–≤–µ—Ç–∏—Ç—å</button>
                            <button class="btn-red" onclick="deleteMsg(${msg.id})">–£–¥–∞–ª–∏—Ç—å</button>
                        </div>
                    `;
                }

                div.innerHTML = content;
                container.appendChild(div);
            });
        }

        // === –û—Ç–≤–µ—Ç–∏—Ç—å ===
        function reply(id) {
            const input = document.getElementById(`reply_${id}`);
            const text = input.value.trim();
            if (!text) {
                alert("–í–≤–µ–¥–∏—Ç–µ –æ—Ç–≤–µ—Ç");
                return;
            }

            load();
            const msg = messages.find(m => m.id == id);
            if (msg) {
                msg.replied = true;
                msg.reply = text;
                save();
            }

            loadAdmin(); // –æ–±–Ω–æ–≤–∏—Ç—å
        }

        // === –£–¥–∞–ª–∏—Ç—å ===
        function deleteMsg(id) {
            if (!confirm("–£–¥–∞–ª–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ?")) return;

            load();
            messages = messages.filter(m => m.id != id);
            save();

            loadAdmin();
        }

        // === –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∫–∏ ===
        setInterval(() => {
            if (document.getElementById("admin-mode").style.display === "block") {
                loadAdmin();
            }
        }, 5000);
    </script>
</body>
</html>
