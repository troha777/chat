<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ê–¥–º–∏–Ω: –°–æ–æ–±—â–µ–Ω–∏—è</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 30px;
            background: #f8f9fa;
            margin: 0;
        }
        h1 {
            color: #343e50;
        }
        .msg {
            background: white;
            border: 1px solid #ddd;
            margin: 15px 0;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        textarea {
            width: 100%;
            padding: 10px;
            margin: 8px 0;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box;
            font-size: 16px;
        }
        button {
            background: #28a745;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background: #218838;
        }
        .reply {
            margin-left: 20px;
            padding: 10px;
            background: #e8f5e8;
            border-left: 4px solid #28a745;
            font-size: 16px;
        }
        .time {
            font-size: 0.9em;
            color: #6c757d;
        }
        #login {
            text-align: center;
            padding: 50px;
            font-size: 18px;
        }
        #login input {
            padding: 10px;
            font-size: 16px;
            margin: 10px;
            width: 200px;
        }
        #messages-container {
            display: none;
        }
    </style>
</head>
<body>
    <!-- –§–æ—Ä–º–∞ –≤—Ö–æ–¥–∞ -->
    <div id="login">
        <h2>üîê –í—Ö–æ–¥ –≤ –∞–¥–º–∏–Ω–∫—É</h2>
        <p>–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –¥–ª—è –¥–æ—Å—Ç—É–ø–∞</p>
        <input type="password" id="password" placeholder="–ü–∞—Ä–æ–ª—å"><br>
        <button onclick="checkPassword()">–í–æ–π—Ç–∏</button>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç (—Å–∫—Ä—ã—Ç) -->
    <div id="messages-container" style="display:none;">
        <h1>üì¨ –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h1>
        <p><strong>–°–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:</strong></p>
        <div id="list"></div>
    </div>

    <script>
        // üîê –£—Å—Ç–∞–Ω–æ–≤–∏ —Å–≤–æ–π –ø–∞—Ä–æ–ª—å –∑–¥–µ—Å—å
        const ADMIN_PASSWORD = "12345";  // ‚Üê –ò–∑–º–µ–Ω–∏ –Ω–∞ —Å–≤–æ–π

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–æ–ª—è
        function checkPassword() {
            const input = document.getElementById("password").value;
            if (input === ADMIN_PASSWORD) {
                document.getElementById("login").style.display = "none";
                document.getElementById("messages-container").style.display = "block";
                loadMessages();
            } else {
                alert("‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å!");
            }
        }

        // –ù–∞–∂–∞—Ç–∏–µ Enter –≤ –ø–æ–ª–µ
        document.getElementById("password").addEventListener("keydown", function(e) {
            if (e.key === "Enter") {
                checkPassword();
            }
        });

        // –•—Ä–∞–Ω–∏–º —Ç–µ–∫—Å—Ç, –∫–æ—Ç–æ—Ä—ã–π —É–∂–µ –Ω–∞–±—Ä–∞–ª–∏
        const typedReplies = {};

        function loadMessages() {
            const messages = JSON.parse(localStorage.getItem("messages") || "[]");
            const container = document.getElementById("list");
            container.innerHTML = "";

            messages.forEach(msg => {
                const msgId = msg.id;
                const exists = document.getElementById(`msg-${msgId}`);

                if (exists) {
                    if (msg.replied && !exists.innerHTML.includes("–í—ã:")) {
                        document.getElementById(`reply-${msgId}`).innerHTML = `<strong>üìå –í—ã:</strong> ${msg.reply}`;
                    }
                    return;
                }

                const div = document.createElement("div");
                div.className = "msg";
                div.id = `msg-${msgId}`;

                let replySection = '';
                if (!msg.replied) {
                    const savedText = typedReplies[msgId] || '';
                    replySection = `
                        <div class="reply-box">
                            <textarea id="reply_input_${msgId}" placeholder="–ù–∞–ø–∏—Å–∞—Ç—å –æ—Ç–≤–µ—Ç...">${savedText}</textarea><br>
                            <button onclick="sendReply(${msgId})">–û—Ç–≤–µ—Ç–∏—Ç—å</button>
                        </div>
                    `;
                } else {
                    replySection = `
                        <div class="reply" id="reply-${msgId}">
                            <strong>üìå –í—ã:</strong> ${msg.reply}
                        </div>
                    `;
                }

                div.innerHTML = `
                    <div><strong>üí¨</strong> ${msg.text}</div>
                    <div class="time">üïí ${msg.time}</div>
                    ${replySection}
                `;

                container.appendChild(div);
            });
        }

        function saveTyping(id) {
            const input = document.getElementById(`reply_input_${id}`);
            if (input) typedReplies[id] = input.value;
        }

        function sendReply(id) {
            const input = document.getElementById(`reply_input_${id}`);
            const text = input.value.trim();
            if (!text) {
                alert("–í–≤–µ–¥–∏—Ç–µ –æ—Ç–≤–µ—Ç");
                return;
            }

            const messages = JSON.parse(localStorage.getItem("messages") || "[]");
            const msg = messages.find(m => m.id === id);
            if (msg) {
                msg.replied = true;
                msg.reply = text;
                localStorage.setItem("messages", JSON.stringify(messages));
                alert("–û—Ç–≤–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!");
                const replyBox = document.querySelector(`#msg-${id} .reply-box`);
                if (replyBox) {
                    replyBox.outerHTML = `<div class="reply" id="reply-${id}"><strong>üìå –í—ã:</strong> ${msg.reply}</div>`;
                }
            }
            delete typedReplies[id];
        }

        window.addEventListener('input', (e) => {
            const match = e.target.id.match(/reply_input_(\d+)/);
            if (match) saveTyping(parseInt(match[1]));
        });

        setInterval(loadMessages, 10000);
    </script>
</body>
</html>
